// Generated by CoffeeScript 1.9.2
(function() {
  var group_request, join_group, join_group_request, leave_group, load_achievement_info, load_group_info, load_team_info, renderAchievementInformation, renderGroupInformation, renderTeamInformation;

  renderTeamInformation = _.template($("#team-info-template").remove().text());

  renderGroupInformation = _.template($("#group-info-template").remove().text());

  renderAchievementInformation = _.template($("#achievement-info-template").remove().text());

  load_team_info = function() {
    return apiCall("GET", "/api/team").done(function(data) {
      var j, x;
      switch (data["status"]) {
        case 0:
          apiNotify(data);
          return ga('send', 'event', 'Team', 'LoadFailure', data.message);
        case 1:
          $("#team-info").html(renderTeamInformation({
            data: data.data
          }));
          x = "<ul>" + ((function() {
            var i, len, ref, results;
            ref = data.data.justification;
            results = [];
            for (i = 0, len = ref.length; i < len; i++) {
              j = ref[i];
              results.push("<li>" + _.escape(j) + "</li>");
            }
            return results;
          })()).join("") + "</ul>";
          return $('#eligibility-exp').data("content", x);
      }
    });
  };

  load_group_info = function() {
    return apiCall("GET", "/api/group/list").done(function(data) {
      switch (data["status"]) {
        case 0:
          apiNotify(data);
          return ga('send', 'event', 'Team', 'GroupLoadFailure', data.message);
        case 1:
          $("#group-info").html(renderGroupInformation({
            data: data.data
          }));
          $("#join-group").on("click", group_request);
          $("#group-request-form").on("submit", join_group_request);
          return $(".leave-group-span").on("click", function(e) {
            return leave_group($(e.target).data("group-name"), $(e.target).data("group-owner"));
          });
      }
    });
  };

  load_achievement_info = function() {
    return apiCall("GET", "/api/achievements").done(function(data) {
      switch (data['status']) {
        case 0:
          apiNotify(data);
          return ga('send', 'event', 'Achievements', 'LoadFailure', data.message);
        case 1:
          console.log(data.data);
          return $("#achievement-info").html(renderAchievementInformation({
            data: data.data
          }));
      }
    });
  };

  join_group = function(group_name, group_owner) {
    return apiCall("POST", "/api/group/join", {
      "group-name": group_name,
      "group-owner": group_owner
    }).done(function(data) {
      apiNotify(data);
      if (data["status"] === 1) {
        ga('send', 'event', 'Team', 'JoinGroup', 'Success');
        return load_group_info();
      } else {
        return ga('send', 'event', 'Team', 'JoinGroup', 'Failure::' + data.message);
      }
    });
  };

  leave_group = function(group_name, group_owner) {
    return apiCall("POST", "/api/group/leave", {
      "group-name": group_name,
      "group-owner": group_owner
    }).done(function(data) {
      apiNotify(data);
      if (data["status"] === 1) {
        ga('send', 'event', 'Team', 'LeaveGroup', 'Success');
        return load_group_info();
      } else {
        return ga('send', 'event', 'Team', 'LeaveGroup', 'Failure::' + data.message);
      }
    });
  };

  group_request = function(e) {
    var form;
    e.preventDefault();
    form = $(this).closest("form");
    return confirmDialog("By joining a class you are allowing the instructor to see individual statistics concerning your team's performance. Are you sure you want to join this class?", "Class Confirmation", "Join", "Cancel", function(e) {
      return form.trigger("submit");
    }, function(e) {
      return ga('send', 'event', 'Team', 'JoinGroup', 'RejectPrompt');
    });
  };

  join_group_request = function(e) {
    var group_name, group_owner;
    e.preventDefault();
    group_name = $("#group-name-input").val();
    group_owner = $("#group-owner-input").val();
    return join_group(group_name, group_owner);
  };

  $(function() {
    load_team_info();
    load_group_info();
    load_achievement_info();
    window.drawTeamProgressionGraph("#team-progression-graph", "#team-progression-graph-container");
  });

}).call(this);
